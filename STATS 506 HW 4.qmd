---
title: "STATS 506 HW 4"
author: "Calder Moore"
format: pdf
editor: visual
---

# STATS 506 HW 4

## Problem 1 - Tidyverse: New Zealand

### a)

```{r}
library(tidyverse)
library(nzelect)

nztib <- tibble(vote = nzge$votes, year = nzge$election_year, type = nzge$voting_type) %>%
          group_by(type, year) %>%
          summarise(vote_total = sum(vote)) %>%
          arrange(desc(vote_total))

nztib
```

### b)

```{r}
vote2014 <- tibble(vote = nzge$votes, year = nzge$election_year, party = nzge$party) %>%
              group_by(year, party) %>%
              filter(year == 2014) %>%
              summarise(vote_total = sum(vote)) %>%
              mutate(vote_percent = 100*vote_total/sum(vote_total))
              
vote2014          
```

### c)

```{r}
win <- tibble(vote = nzge$votes, year = nzge$election_year, party = nzge$party, type = nzge$voting_type) %>%
              group_by(year, party, type) %>%
              summarise(vote_total = sum(vote)) %>%
              group_by(year) %>%
              mutate(vote_percent = 100*vote_total/sum(vote_total)) %>%
              group_by(year, type) %>%
              mutate(winner = party[which.max(vote_percent)]) %>%
              slice_max(vote_percent) %>%
              select(year, type, winner)

win  
```

## Problem 2 - Tidyverse: Tennis

### a)

```{r}
tennis <- read.csv("atp_matches_2019.txt")

tourney_count <- tennis %>%
  mutate(tourney_date = ymd(tourney_date)) %>%
  filter(year(tourney_date) == 2019) %>%
  distinct(tourney_date)

nrow(tourney_count)
```

There were 48 tournaments in 2019.

### b)

```{r}
winners <- tennis %>%
  group_by(tourney_id) %>%
  slice_head(n = 1) %>%
  ungroup() %>%
  count(winner_name, sort = TRUE) %>%
  filter(n > 1)

nrow(winners)

max(winners$n)
```

25 players have won more than one tournament, and the most winning player has won 7 tournaments.

### c)

```{r}
tennis %>%
  summarise(
    w_ace_mean = mean(w_ace, na.rm = TRUE),
    l_ace_mean  = mean(l_ace, na.rm = TRUE),
    w_ace_sd   = sd(w_ace, na.rm = TRUE),
    l_ace_sd    = sd(l_ace, na.rm = TRUE)
  )
```

They have similar standard deviations and the means are around 2 aces apart, so there does seem to be evidence for a difference in means in the number of aces hit by winners vs losers.

### d)

```{r}
players <- tennis %>%
  select(tourney_id, winner_name, loser_name) %>%
  pivot_longer(
    cols = c(winner_name, loser_name),
    names_to = "outcome",
    values_to = "player") %>%
  mutate(
    win = if_else(outcome == "winner_name", 1, 0)
  )

winrate <- players %>%
  group_by(player) %>%
  summarise(
    games = n(),
    wins = sum(win),
    win_rate = wins/games) %>%
  filter(games > 5) %>%
  arrange(desc(win_rate))

winrate
```

Nadal has the highest win rate at 86.96% of games won.

## Problem 3 - Visualization

### a)

```{r}
library(ggplot2)
covid <- read.csv("us-states.txt")

covid$date <- as.Date(covid$date)

case_mean <- covid %>%
  group_by(date) %>%
  summarise(cases_avg = mean(cases_avg, na.rm = TRUE))

ggplot(covid, aes(x = date, y = cases)) +
  geom_point() +
  geom_line(data = case_mean, aes(y = cases_avg), color = "red", linewidth = 1) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %Y") + 
  labs(title = "US Covid Cases", x = "Date", y = "Cases")
```

There seem to be two major spikes in December 2020 - January 2021 and again from December 2021 - January 2022, and five smaller spikes in April 2020, July 2020, September 2021, July 2022, and December 2022.

### b)

```{r}
states <- covid %>%
  group_by(state) %>%
  summarise(rate_avg = mean(cases_avg_per_100k, na.rm = TRUE)) %>%
  arrange(desc(rate_avg))

states$state[1:3]
states$state[(nrow(states)-2):nrow(states)]
```

American Samoa, Rhode Island, and Alaska have the highest rates and Oregon, Maine, and Maryland have the lowest rates.

```{r}
case_states <- covid %>%
  filter(state %in% c(states$state[1:3], states$state[(nrow(states)-2):nrow(states)]))

ggplot(data = case_states, aes(x = date, y = cases)) + 
  geom_point() + 
  labs(title = "Covid Cases", x = "Date", y = "Cases") + 
  facet_wrap(vars(state))
```

Interestingly it appears that the states with the lowest average were actually hit harder by the big spike in early 2022. Despite having the highest running average, American Samoa appears to have a relatively flat line, possibly with their average just being higher in general even though they didn't experience an extreme spike, or because there isn't any data from there prior to late 2021.

### c)

```{r, fig.width=10, fig.height=8}
state_list <- unique(covid$state)

firsthalf <- state_list[1:(length(state_list)/2)]
secondhalf <- state_list[(length(state_list)/2 + 1):length(state_list)]

plot1 <- covid %>%
  filter(state %in% firsthalf) %>%
  filter(date < as.Date("2021-01-01"))

plot2 <- covid %>%
  filter(state %in% secondhalf) %>%
  filter(date < as.Date("2021-01-01"))

ggplot(data = plot1, aes(x = date, y = cases)) + 
  geom_point() + 
  labs(title = "Covid Cases", x = "Date", y = "Cases") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  theme(axis.text.y = element_text(size = 7)) +
  facet_wrap(vars(state))

ggplot(data = plot2, aes(x = date, y = cases)) + 
  geom_point() + 
  labs(title = "Covid Cases", x = "Date", y = "Cases") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  theme(axis.text.y = element_text(size = 7)) +
  facet_wrap(vars(state))
```

New York, Florida, Connecticut, Michigan, and New Jersey were among some of the states that were hit by covid cases earliest.
